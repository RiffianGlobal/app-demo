import{N as k,T as y,a as B,t as I,n as N,g as q,c as L,b as f}from"./index-TEFf3_6H.js";import{x as o,e as V,h as M,d as b,b as x,z as U,A as G,D as H,E as K,G as O,H as X,a as T,c as p,u as j,f as l}from"./vendor-od9KRoES.js";const z=function(e){let{status:s,statusText:t}=e;if(e.ok)return e;t||(t+=s);let r=new Error(t);throw Object.assign(r,{raw:e,code:s,message:t}),r},F=function(e){const s=e.headers.get("content-type");return/^image\//.test(s)?e.blob():/^(text)\//.test(s)?e.text():e.json().catch(function(t){throw t}).then(function(t){const r=t.data??t.result??t,a=t.error_code??r.error_code??r.code??r.error??t.code??(r.errors?"Errors":void 0)??e.status;if(a&&![200].includes(a)){const i=r.error_message||r.error_msg||r.message||r.msg||t.msg||t.message||t.data||(r.errors??[]).map(n=>n.message).join(`

`);throw Object.assign(new Error(a),{code:a,message:i,raw:e})}return r})},R=async function(e,s={}){const t={method:"GET",headers:{accept:"application/json, */*"},mode:"cors",credentials:"same-origin"};return Object.assign(s,t,{...s}),s.headers&&Object.assign(s.headers,t.headers,{...s.headers}),fetch(e,s).then(z).then(F).catch(function(r){throw r})},J=e=>!/^(?:[a-z+]+:)?\/\//.test(e),Q=e=>J(e)?location.origin+(/^\//.test(e)?"":location.pathname):e,P=function(e,s={}){const t=new URL(e,Q(e));for(let r in s)t.searchParams.set(r,s[r]);return t.toString()};class Y{constructor(){this.fetch=R}get(s,t={},r){return R(P(s,t),r)}post(s,t={},{method:r="POST",form:a=!1,search:i=!1,headers:n={}}={}){const c=a?new URLSearchParams(t).toString():JSON.stringify(t);return R(i?P(s,t):s,{method:r,headers:{"Content-Type":a?"application/x-www-form-urlencoded":"application/json",...n},body:c})}delete(s,t={},r={}){return this.post(s,t,{...r,method:"DELETE"})}}const Z=new Y,D={main:{"0x1":"https://api.studio.thegraph.com/query/","0xaa36a7":"https://api.studio.thegraph.com/query/","0x5":"https://api.studio.thegraph.com/query/"},MediaBoard:{"0xfa2":"https://api.thegraph.com/subgraphs/name/pho360360/riffianboard"}},tt=e=>{let s=D[e][k.chainId];return s||(console.error(`Not available for selected network(chain id ${k.chainId}). Fallback to default chainid`),s=D[e][k.defaultChainId]),s},yt=async(e="main",s,t,r)=>Z.post(tt(e),{query:s,variables:t,operationName:r}),et='.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}';var st=Object.defineProperty,rt=Object.getOwnPropertyDescriptor,v=(e,s,t,r)=>{for(var a=r>1?void 0:r?rt(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&st(s,t,a),a};let g=class extends y(et){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?o`<slot></slot>`:o`<div class="skeleton ${V(this.$c([this.class]))}">${M(this.groups,()=>o`<div class="p"></div>`)}</div>`}};v([b({type:Boolean})],g.prototype,"expect",2);v([b({type:Number})],g.prototype,"num",2);v([b({type:String})],g.prototype,"class",2);g=v([x("loading-skeleton")],g);var at=Object.defineProperty,it=Object.getOwnPropertyDescriptor,W=(e,s,t,r)=>{for(var a=r>1?void 0:r?it(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&at(s,t,a),a};let S=class extends y(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return o`<div class="block mx-auto my-8 text-center text-xl"><i class="mdi mdi-loading mx-1"></i></div>`;default:return o`<i class="mdi mdi-loading mr-1"></i><slot>Loading...</slot>`}}};W([b({type:String})],S.prototype,"type",2);S=W([x("loading-icon")],S);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class nt extends G{constructor(){super(...arguments),this._$Cq=new H(this),this._$CK=new K}render(s,t){return O}update(s,[t,r]){if(this.isConnected||this.disconnected(),t===this._$CX)return;this._$CX=t;let a=0;const{_$Cq:i,_$CK:n}=this;return X(t,async c=>{for(;n.get();)await n.get();const d=i.deref();if(d!==void 0){if(d._$CX!==t)return!1;r!==void 0&&(c=r(c,a)),d.commitValue(c,a),a++}return!0}),O}commitValue(s,t){this.setValue(s)}disconnected(){this._$Cq.disconnect(),this._$CK.pause()}reconnected(){this._$Cq.reconnect(this),this._$CK.resume()}}const ot=U(nt),$=async()=>q("MediaBoard",{account:await L()}),ct=async()=>{const e=await $(),s="claimReward",t={},r=[_()];await B(t,e,s,r);const a=e[s](...r);return new I(a,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"ClaimAlbumRewards",title:"Claim Album Rewards",ts:N(),overrides:t}})},lt=async e=>{const s=await $(),t=await _(),r="userWeeklyVotes",a=[e,t];let i=await s[r](...a);const n="weeklyVotes",c=[t];let d=await s[n](...c);return d==0n?0:await A()*i/d},A=async()=>{const e=await $(),s="weeklyReward",t=[_()];return await e[s](...t)};var w=0n;const _=async()=>{if(w!=0n)return w;let t=await(await $())["startTimeStamp"]();const r=7n*24n*60n*60n;let a=BigInt(new Date().getTime())/1000n;return w=a-(a-t)%r,w};var dt=Object.defineProperty,ht=Object.getOwnPropertyDescriptor,u=(e,s,t,r)=>{for(var a=r>1?void 0:r?ht(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&dt(s,t,a),a};const E=()=>({tx:""});let h=class extends y(""){constructor(){super(...arguments),this.bindBridge=new T(this,f),this.userWeeklyReward=-1,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=E(),this.resetState=()=>{this.err=E(),this.pending=!1,this.success=!1,this.userWeeklyReward=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(e={})=>this.err=Object.assign({},this.err,e)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{this.userWeeklyReward=await lt(f.bridge.account)}catch(e){let s=e.message||e.code;this.updateErr({tx:s})}finally{}}async claim(){this.pending=!0;try{this.tx=await ct(),this.success=await this.tx.wait()}catch(e){console.log(e);let s=e.message||e.code;if(e.code==="ACTION_REJECTED"||e.code==="INVALID_ARGUMENT")return this.updateErr({tx:s}),this.close()}finally{this.pending=!1}}render(){return o`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Claim Rewards</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md">${p(!(this.userWeeklyReward>=0),()=>o`<div class="my-4"><loading-icon></loading-icon></div>`)} ${p(this.userWeeklyReward>=0&&!this.pending,()=>o`<p class="font-bold">Reward Value</p><p class="text-xl text-sky-500">${j(this.userWeeklyReward,18)} FTM</p><ui-button ?disabled="${this.userWeeklyReward<=0}" class="m-1" @click="${this.claim}">CLAIM</ui-button>`)}${p(this.pending,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your claim request has been submit."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};u([l()],h.prototype,"userWeeklyReward",2);u([l()],h.prototype,"tx",2);u([l()],h.prototype,"success",2);u([l()],h.prototype,"pending",2);u([l()],h.prototype,"rewards",2);u([l()],h.prototype,"err",2);h=u([x("claim-reward-dialog")],h);const ut=".text-highlight{color:var(--colorHighlight)}";var pt=Object.defineProperty,gt=Object.getOwnPropertyDescriptor,C=(e,s,t,r)=>{for(var a=r>1?void 0:r?gt(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&pt(s,t,a),a};let m=class extends y(ut){constructor(){super(...arguments),this.bindBridge=new T(this,f),this.rewards=0,this.pending=!0,this.dialog=!1,this.timeCountDown=async function*(){const e=7n*24n*60n*60n;let s=await _(),t=0n;do{let r=BigInt(new Date().getTime())/1000n;t=s+e-r;let a=t/86400n,i=(t-a*86400n)/3600n,n=(t-a*86400n-i*3600n)/60n,c=t-a*86400n-i*3600n-n*60n;yield a.toString()+"D "+i.toString().padStart(2,"0")+"H "+n.toString().padStart(2,"0")+"M "+c.toString().padStart(2,"0"),await new Promise(d=>setTimeout(d,1e3))}while(t>1)},this.open=()=>this.dialog=!0,this.close=()=>this.dialog=!1}get disabled(){return!f.bridge.account}connectedCallback(){super.connectedCallback(),this.weeklyRewards()}async weeklyRewards(){try{this.pending=!0;let e=await A();this.rewards=e,this.pending=!1}catch(e){console.error("test"),e.message||e.code}}render(){return o`${p(this.pending,()=>o`<i class="text-lg mdi mdi-loading"></i>`,()=>o`<div class="text-right"><div class="font-light text-2xl text-highlight"><ui-button icon class="ml-1 mx-auto sm" @click="${this.open}" ?disabled="${this.disabled}" title="Claim"><i class="mdi mdi-hand-coin-outline"></i></ui-button>${j(this.rewards,18)}</div><div class="font-light text-green-500 mt-2">${ot(this.timeCountDown())}</div></div>`)} ${p(this.dialog,()=>o`<claim-reward-dialog @close="${this.close}"></claim-reward-dialog>`)}`}};C([l()],m.prototype,"rewards",2);C([l()],m.prototype,"pending",2);C([l()],m.prototype,"dialog",2);m=C([x("claim-rewards")],m);export{_ as a,yt as g,ot as h};
