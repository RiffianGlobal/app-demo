import{N as k,T as y,a as W,t as I,n as q,g as A,c as L,b as f}from"./index-j07SvdS3.js";import{x as o,e as V,h as M,d as b,b as x,z as U,A as G,D as H,E as J,G as O,H as K,a as E,c as g,u as j,f as l}from"./vendor-od9KRoES.js";const X=function(e){let{status:s,statusText:t}=e;if(e.ok)return e;t||(t+=s);let r=new Error(t);throw Object.assign(r,{raw:e,code:s,message:t}),r},z=function(e){const s=e.headers.get("content-type");return/^image\//.test(s)?e.blob():/^(text)\//.test(s)?e.text():e.json().catch(function(t){throw t}).then(function(t){const r=t.data??t.result??t,a=t.error_code??r.error_code??r.code??r.error??t.code??(r.errors?"Errors":void 0)??e.status;if(a&&![200].includes(a)){const i=r.error_message||r.error_msg||r.message||r.msg||t.msg||t.message||t.data||(r.errors??[]).map(n=>n.message).join(`

`);throw Object.assign(new Error(a),{code:a,message:i,raw:e})}return r})},R=async function(e,s={}){const t={method:"GET",headers:{accept:"application/json, */*"},mode:"cors",credentials:"same-origin"};return Object.assign(s,t,{...s}),s.headers&&Object.assign(s.headers,t.headers,{...s.headers}),fetch(e,s).then(X).then(z).catch(function(r){throw r})},F=e=>!/^(?:[a-z+]+:)?\/\//.test(e),Q=e=>F(e)?location.origin+(/^\//.test(e)?"":location.pathname):e,P=function(e,s={}){const t=new URL(e,Q(e));for(let r in s)t.searchParams.set(r,s[r]);return t.toString()};class Y{constructor(){this.fetch=R}get(s,t={},r){return R(P(s,t),r)}post(s,t={},{method:r="POST",form:a=!1,search:i=!1,headers:n={}}={}){const c=a?new URLSearchParams(t).toString():JSON.stringify(t);return R(i?P(s,t):s,{method:r,headers:{"Content-Type":a?"application/x-www-form-urlencoded":"application/json",...n},body:c})}delete(s,t={},r={}){return this.post(s,t,{...r,method:"DELETE"})}}const Z=new Y,D={main:{"0x1":"https://api.studio.thegraph.com/query/","0xaa36a7":"https://api.studio.thegraph.com/query/","0x5":"https://api.studio.thegraph.com/query/"},MediaBoard:{"0xfa2":"https://api.thegraph.com/subgraphs/name/pho360360/riffianboard"}},tt=e=>{let s=D[e][k.chainId];return s||(console.error(`Not available for selected network(chain id ${k.chainId}). Fallback to default chainid`),s=D[e][k.defaultChainId]),s},et=async(e="main",s,t,r)=>Z.post(tt(e),{query:s,variables:t,operationName:r}),st='.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:rgba(222,226,230)}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,rgba(255,255,255,0) 8%,rgba(255,255,255,.8) 36%,rgba(255,255,255,0) 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}';var rt=Object.defineProperty,at=Object.getOwnPropertyDescriptor,v=(e,s,t,r)=>{for(var a=r>1?void 0:r?at(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&rt(s,t,a),a};let w=class extends y(st){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?o`<slot></slot>`:o`<div class="skeleton ${V(this.$c([this.class]))}">${M(this.groups,()=>o`<div class="p"></div>`)}</div>`}};v([b({type:Boolean})],w.prototype,"expect",2);v([b({type:Number})],w.prototype,"num",2);v([b({type:String})],w.prototype,"class",2);w=v([x("loading-skeleton")],w);var it=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,B=(e,s,t,r)=>{for(var a=r>1?void 0:r?nt(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&it(s,t,a),a};let S=class extends y(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return o`<div class="block mx-auto my-8 text-center text-xl"><i class="mdi mdi-loading mx-1"></i></div>`;default:return o`<i class="mdi mdi-loading mr-1"></i><slot>Loading...</slot>`}}};B([b({type:String})],S.prototype,"type",2);S=B([x("loading-icon")],S);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class ot extends G{constructor(){super(...arguments),this._$Cq=new H(this),this._$CK=new J}render(s,t){return O}update(s,[t,r]){if(this.isConnected||this.disconnected(),t===this._$CX)return;this._$CX=t;let a=0;const{_$Cq:i,_$CK:n}=this;return K(t,async c=>{for(;n.get();)await n.get();const d=i.deref();if(d!==void 0){if(d._$CX!==t)return!1;r!==void 0&&(c=r(c,a)),d.commitValue(c,a),a++}return!0}),O}commitValue(s,t){this.setValue(s)}disconnected(){this._$Cq.disconnect(),this._$CK.pause()}reconnected(){this._$Cq.reconnect(this),this._$CK.resume()}}const ct=U(ot),$=async()=>A("MediaBoard",{account:await L()}),lt=async()=>{const e=await $(),s="claimReward",t={},r=[_()];await W(t,e,s,r);const a=e[s](...r);return new I(a,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"ClaimAlbumRewards",title:"Claim Album Rewards",ts:q(),overrides:t}})},dt=async e=>{const s=await $(),t=await _(),r="userWeeklyVotes",a=[e,t];let i=await s[r](...a);const n="weeklyVotes",c=[t];let d=await s[n](...c);return d==0n?0:await N()*i/d},N=async()=>{const e=await $(),s="weeklyReward",t=[_()];return await e[s](...t)};var h=0n;const ht=async()=>await et("MediaBoard",`{
      statistic(id:"riffian") {
        week
      }
    }`),_=async()=>{if(h!=0n)return h;const e=7n*24n*60n*60n;try{let r=await(await $())["startTimeStamp"](),a=BigInt(new Date().getTime())/1000n;h=a-(a-r)%e}catch{let t=await ht(),r=BigInt(new Date().getTime())/1000n;h=BigInt(t.statistic.week),h=r-(r-h)%e,console.log("weekbegin",t,h)}return h};var ut=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,p=(e,s,t,r)=>{for(var a=r>1?void 0:r?pt(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&ut(s,t,a),a};const T=()=>({tx:""});let u=class extends y(""){constructor(){super(...arguments),this.bindBridge=new E(this,f),this.userWeeklyReward=-1,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=T(),this.resetState=()=>{this.err=T(),this.pending=!1,this.success=!1,this.userWeeklyReward=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(e={})=>this.err=Object.assign({},this.err,e)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{this.userWeeklyReward=await dt(f.bridge.account)}catch(e){let s=e.message||e.code;this.updateErr({tx:s})}finally{}}async claim(){this.pending=!0;try{this.tx=await lt(),this.success=await this.tx.wait()}catch(e){console.log(e);let s=e.message||e.code;if(e.code==="ACTION_REJECTED"||e.code==="INVALID_ARGUMENT")return this.updateErr({tx:s}),this.close()}finally{this.pending=!1}}render(){return o`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Claim Rewards</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md">${g(!(this.userWeeklyReward>=0),()=>o`<div class="my-4"><loading-icon></loading-icon></div>`)} ${g(this.userWeeklyReward>=0&&!this.pending,()=>o`<p class="font-bold">Reward Value</p><p class="text-xl text-sky-500">${j(this.userWeeklyReward,18)} FTM</p><ui-button ?disabled="${this.userWeeklyReward<=0}" class="m-1" @click="${this.claim}">CLAIM</ui-button>`)}${g(this.pending,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your claim request has been submit."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};p([l()],u.prototype,"userWeeklyReward",2);p([l()],u.prototype,"tx",2);p([l()],u.prototype,"success",2);p([l()],u.prototype,"pending",2);p([l()],u.prototype,"rewards",2);p([l()],u.prototype,"err",2);u=p([x("claim-reward-dialog")],u);const gt=".text-highlight{color:var(--colorHighlight)}";var wt=Object.defineProperty,mt=Object.getOwnPropertyDescriptor,C=(e,s,t,r)=>{for(var a=r>1?void 0:r?mt(s,t):s,i=e.length-1,n;i>=0;i--)(n=e[i])&&(a=(r?n(s,t,a):n(a))||a);return r&&a&&wt(s,t,a),a};let m=class extends y(gt){constructor(){super(...arguments),this.bindBridge=new E(this,f),this.rewards=0,this.pending=!0,this.dialog=!1,this.timeCountDown=async function*(){const e=7n*24n*60n*60n;let s=await _(),t=0n;do{let r=BigInt(new Date().getTime())/1000n;t=s+e-r;let a=t/86400n,i=(t-a*86400n)/3600n,n=(t-a*86400n-i*3600n)/60n,c=t-a*86400n-i*3600n-n*60n;yield a.toString()+"D "+i.toString().padStart(2,"0")+"H "+n.toString().padStart(2,"0")+"M "+c.toString().padStart(2,"0"),await new Promise(d=>setTimeout(d,1e3))}while(t>1)},this.open=()=>this.dialog=!0,this.close=()=>this.dialog=!1}get disabled(){return!f.bridge.account}connectedCallback(){super.connectedCallback(),this.weeklyRewards()}async weeklyRewards(){try{this.pending=!0;let e=await N();this.rewards=e,this.pending=!1}catch(e){console.error("claim",e)}}render(){return o`<div class="text-right"><div class="font-light text-2xl text-highlight">${g(this.pending,()=>o`<i class="text-lg mdi mdi-loading"></i>`,()=>o`<ui-button icon class="ml-1 mx-auto sm" @click="${this.open}" ?disabled="${this.disabled}" title="Claim"><i class="mdi mdi-hand-coin-outline"></i></ui-button>${j(this.rewards,18)}`)}</div><div class="font-light text-green-500 mt-2">${ct(this.timeCountDown())}</div></div>${g(this.dialog,()=>o`<claim-reward-dialog @close="${this.close}"></claim-reward-dialog>`)}`}};C([l()],m.prototype,"rewards",2);C([l()],m.prototype,"pending",2);C([l()],m.prototype,"dialog",2);m=C([x("claim-rewards")],m);export{_ as a,et as g,ct as h};
