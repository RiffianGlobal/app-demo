import{a as m,t as j,n as _,g as P,c as S,T as v,b as h,e as O}from"./index-hv_Ss9Wk.js";import{g as C}from"./claim-3Jj_cuA6.js";import{c as $,x as n,d as u,q as V,g as c,e as b,t as f,h as A,f as E}from"./vendor-_aDU801h.js";const x=async()=>P("MediaBoard",{account:await S()}),R=async(t,s)=>{const r=await x(),i="getRetreatPrice",e={},a=[t,s];return await m(e,r,i,a),await r[i](...a)},T=async(t,s)=>{const r=await x(),i="userSubjectVotes",e={},a=[t,s];return await m(e,r,i,a),await r[i](...a)},D=async(t,s)=>{const r=await x(),i="retreat",e={},a=[t,s];await m(e,r,i,a);const o=r[i](...a);return new j(o,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"RetreatSubject",title:"Retreat Subject",ts:_(),overrides:e}})},M=async t=>{let s=`{
      userSubjectVotes(where:{holding_gt:0,user:"${t.toLowerCase()}"}) {
        holding
        votes
        subject {
          id
          name
          image
          uri
          supply
          creator{
            address
          }
        }
      }
    }`;return await C("MediaBoard",s)};var B=Object.defineProperty,k=Object.getOwnPropertyDescriptor,d=(t,s,r,i)=>{for(var e=i>1?void 0:i?k(s,r):s,a=t.length-1,o;a>=0;a--)(o=t[a])&&(e=(i?o(s,r,e):o(e))||e);return i&&e&&B(s,r,e),e};const w=()=>({tx:""});let l=class extends v(""){constructor(){super(...arguments),this.bindBridge=new $(this,h),this.album="",this.url="",this.votes=0,this.price=0,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=w(),this.resetState=()=>{this.err=w(),this.pending=!1,this.success=!1,this.price=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(t={})=>this.err=Object.assign({},this.err,t)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{let t=await T(this.album,h.bridge.account);this.votes=t,this.price=await R(this.album,this.votes)}catch(t){let s=t.message||t.code;this.updateErr({tx:s})}}async retreat(){this.pending=!0;try{this.tx=await D(this.album,this.votes),this.success=await this.tx.wait()}catch(t){let s=t.message||t.code;if(t.code===4001)return this.updateErr({tx:s}),this.close()}finally{}}render(){return n`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Retreat Subject</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md"><p class="w-36 h-36"><img-loader src="${this.url}"></img-loader></p>${u(!this.price,()=>n`<div class="my-4"><loading-skeleton num="3"></loading-skeleton><p class="my-4">Loading subject data...</p></div>`)} ${u(this.price&&!this.pending,()=>n`<p class="font-bold">Estimated returned value</p><p class="text-xl text-sky-500">${V(this.price,18)} FTM</p><p>Your Votes:${this.votes}</p><ui-button class="m-1" @click="${this.retreat}">RETREAT</ui-button>`)}${u(this.pending,()=>n`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your retreat has been submitted."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};d([b({type:String})],l.prototype,"album",2);d([b({type:String})],l.prototype,"url",2);d([b({type:Number})],l.prototype,"votes",2);d([c()],l.prototype,"price",2);d([c()],l.prototype,"tx",2);d([c()],l.prototype,"success",2);d([c()],l.prototype,"pending",2);d([c()],l.prototype,"rewards",2);d([c()],l.prototype,"err",2);l=d([f("retreat-vote-dialog")],l);const z="li.header{margin-bottom:.5rem;font-weight:300;--tw-text-opacity: 1;color:#fafaf9;color:rgba(250,250,249,var(--tw-text-opacity));border-bottom:1px solid #898989}li.item:hover{--tw-bg-opacity: 1;background-color:#3f3f46;background-color:rgba(63,63,70,var(--tw-bg-opacity))}@media (min-width: 500px){.name{font-size:1.25rem;line-height:1.75rem}}.icon{font-size:1.875rem;line-height:2.25rem}@media (max-width: 500px){.icon{font-size:1.5rem;line-height:2rem}}";var L=Object.defineProperty,q=Object.getOwnPropertyDescriptor,g=(t,s,r,i)=>{for(var e=i>1?void 0:i?q(s,r):s,a=t.length-1,o;a>=0;a--)(o=t[a])&&(e=(i?o(s,r,e):o(e))||e);return i&&e&&L(s,r,e),e};let p=class extends v(z){constructor(){super(...arguments),this.bindBridge=new $(this,h),this.userVotes=[],this.dialog=!1,this.currentAlbum={id:"",votes:0,url:""},this.pending=!1,this.init=async()=>{this.pending=!0;let t=await M(h.bridge.account);this.userVotes=t.userSubjectVotes,this.pending=!1},this.close=()=>this.dialog=!1}get disabled(){return!h.bridge.account}connectedCallback(){super.connectedCallback(),this.init()}getRandomInt(t){return Math.floor(Math.random()*t)}render(){return n`<div>${u(this.pending,()=>n`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-8"><loading-skeleton num="3"></loading-skeleton><loading-skeleton num="3"></loading-skeleton><loading-skeleton num="3"></loading-skeleton></div></div>`)} ${u(!this.pending,()=>n`<ul role="list"><li class="flex header p-1"><div class="w-16">Collection</div><div class="flex-auto text-right pr-3">Author</div><div class="flex-none w-16 text-right">Tickets</div><div class="flex-none w-16 text-right">Holding</div>${u(this.pending,()=>n`<div><i class="text-sm mdi mdi-loading"></i><div></div></div>`)}</li>${A(this.userVotes,(t,s)=>n`<li class="flex py-2 items-center cursor-pointer ${E({"bg-zinc-800/50":s%2})}" @click="${()=>{this.disabled?O.emit("connect-wallet"):location.href="/track/"+t.subject.id}}"><div class="flex-initial flex"><div class="w-[4.6rem] h-[4.6rem] mr-4"><img-loader .src="${t.subject.image}"></img-loader></div><div><p class="name truncate mt-2">${t.subject.name}</p><span class="icon mt-1"><i class="mdi mdi-play-circle-outline"></i></span></div></div><div class="flex-auto text-right pr-3 text-lg"><ui-address .address="${t.subject.creator.address}" short avatar></ui-address></div><div class="flex-none w-16 text-2xl font-light text-right">${t.subject.supply}</div><div class="flex-none w-16 text-2xl font-light text-right">${t.holding}</div></li>`)}</ul>`)}</div>`}};g([c()],p.prototype,"userVotes",2);g([c()],p.prototype,"dialog",2);g([c()],p.prototype,"currentAlbum",2);g([c()],p.prototype,"pending",2);p=g([f("user-votes-list")],p);const N="";var U=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,F=(t,s,r,i)=>{for(var e=i>1?void 0:i?Y(s,r):s,a=t.length-1,o;a>=0;a--)(o=t[a])&&(e=(i?o(s,r,e):o(e))||e);return i&&e&&U(s,r,e),e};let y=class extends v(N){render(){return n`<div class="flex px-8 space-x-8 place-content-center"><div class="flex-initial w-[64rem]"><div class="h-20 pt-1 mb-8"><div class="font-bold text-xl">My Votes</div></div><div class="mt-0"><user-votes-list></user-votes-list></div></div></div>`}};y=F([f("user-votes")],y);export{y as ViewTop};
