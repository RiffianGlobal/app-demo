import{g as j,T as y,b as v,a as k,l as _,m as A}from"./index-cb_mfA4o.js";import{i as f,G as $,e as g,$ as C,x as a,j as T,n as h,B as M,f as b,u as l,c as m,g as w}from"./vendor-fjbkuLWx.js";import{m as P}from"./dialog-lbpNOnBZ.js";const O=async t=>{let e=`{
    subject ( id: "${t.toLowerCase()}" ) {
      address createdAt
      fansNumber id image lastVoteAt name supply totalVoteValue
      uri volumeRetreat volumeTotal volumeVote
      creator {
        address id rewardClaimed
        socials { uri pid id platform }
      }
    }
  }`;return await j("MediaBoard",e)},E=async t=>{let e=`{
    subject ( id: "${t.toLowerCase()}" ) {
      address createdAt volumeTotal volumeVote
      fansNumber id image lastVoteAt name supply totalVoteValue uri volumeRetreat 
      creator {
        address id rewardClaimed socials { uri pid id platform }
      }
      userVotes (orderBy: "volumeTotal" orderDirection: "desc" ) {
        volumeRetreat volumeTotal volumeVote votes
        user { address rewardClaimed }
      }
    }
  }`;return await j("MediaBoard",e)},D=".ui-list .item{cursor:pointer;align-items:center}@media (min-width: 768px){.ui-list .name{font-size:1rem;line-height:1.5rem}}";var S=Object.defineProperty,R=Object.getOwnPropertyDescriptor,p=(t,e,i,r)=>{for(var s=r>1?void 0:r?R(e,i):e,n=t.length-1,c;n>=0;n--)(c=t[n])&&(s=(r?c(e,i,s):c(s))||s);return r&&s&&S(e,i,s),s};let u=class extends y(D){constructor(){super(...arguments),this.bindScreen=new f(this,$),this.bindBridge=new f(this,v),this.weekly=!1,this.trackAddress="",this.subjectData={},this.votes=[],this.pending=!1,this.inited=!1,this.prompt=!1,this.promptMessage="",this.fetch=async()=>{this.pending=!0;try{let t=await E(this.trackAddress);this.votes=t.subject.userVotes,this.subjectData=t.subject}catch(t){console.error(t),this.promptMessage=t,this.prompt=!0}finally{this.pending=!1,this.inited=!0}},this.go2=t=>{this.disabled?g.emit("connect-wallet"):C(`/user/${t.user.address}`)},this.listener=k(this.fetch)}get isMobi(){return $.isMobi}get disabled(){return!v.bridge.account}get loading(){return!this.inited&&this.pending}getRandomInt(t){return Math.floor(Math.random()*t)}connectedCallback(){super.connectedCallback(),this.fetch(),g.on("block-world",this.listener)}disconnectedCallback(){super.disconnectedCallback(),g.off("block-world",this.listener)}render(){return a`<div role="list" class="ui-list ${T(this.$c([this.loading?"loading":"hover"]))}"><div class="flex header">${h(!this.isMobi,()=>a`<div class="w-11 text-center">Rank</div>`)}<div class="address flex-auto">Address</div><div class="num flex-none w-20 md_w-28">Comsumption</div><div class="num flex-none w-20 md_w-28">Earning</div></div>${h(this.loading,()=>a`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-6"><div name="Loading" class="doc-intro"><loading-skeleton num="4"></loading-skeleton></div></div></div>`,()=>a`${M(this.votes,(t,e)=>a`<div class="item flex py-2.5" @click="${()=>this.go2(t)}">${h(!this.isMobi,()=>a`<div class="flex-none w-11 text-center text-sm font-light opacity-70">${e+1}</div>`)}<div class="flex-auto"><ui-address .address="${t.user.address}" short avatar class="text-sm md_text-base"></ui-address></div><div class="num flex-none"><p class="num truncate md_mt-2">${parseFloat((+b(t.volumeVote)).toFixed(2))}</p></div><div class="num flex-none w-16 md_w-28"><p class="num truncate md_mt-2">${parseFloat((+b(t.user.rewardClaimed)).toFixed(2))}</p></div></div>`)}`)}</div>${h(this.prompt,()=>a`<p class="text-center text-orange-600">${this.promptMessage}</p>`)}`}};p([m({type:Boolean})],u.prototype,"weekly",2);p([m({type:String})],u.prototype,"trackAddress",2);p([l()],u.prototype,"subjectData",2);p([l()],u.prototype,"votes",2);p([l()],u.prototype,"pending",2);p([l()],u.prototype,"inited",2);p([l()],u.prototype,"prompt",2);p([l()],u.prototype,"promptMessage",2);u=p([w("track-votes")],u);const B=":host{min-height:8rem}@media (min-width: 768px){:host{min-height:11rem}}";var L=Object.defineProperty,F=Object.getOwnPropertyDescriptor,d=(t,e,i,r)=>{for(var s=r>1?void 0:r?F(e,i):e,n=t.length-1,c;n>=0;n--)(c=t[n])&&(s=(r?c(e,i,s):c(s))||s);return r&&s&&L(e,i,s),s};const I=()=>({tx:""});let o=class extends y(B){constructor(){super(...arguments),this.bindBridge=new f(this,v),this.bindTweets=new f(this,_),this.weekly=!1,this.trackAddress="",this.subject=null,this.voteList=[],this.pending=!1,this.prompt=!1,this.dialog=!1,this.promptMessage="",this.err=I(),this.actionType="",this.inited=!1,this.readFromTwitter=async()=>{const{creator:t}=this.subject??{};if(!t)return;const{address:e,socials:i=[]}=t,{uri:r}=i[0]??{};this.social=await _.fromUri(r,e)},this.getPrice=async()=>{try{this.myVotes=await P(this.trackAddress)}catch(t){this.updateErr({tx:t.message||t.code})}},this.updateErr=(t={})=>this.err=Object.assign({},this.err,t),this.fetch=async()=>{this.pending=!0;try{this.getPrice();const{subject:t}=await O(this.trackAddress);this.subject=t,this.readFromTwitter()}catch(t){this.promptMessage=t,this.prompt=!0}finally{this.inited=!0,this.pending=!1}},this.close=()=>{this.dialog=!1},this.setAction=t=>this.actionType=t,this.popAction=(t="vote")=>{t==this.actionType&&this.dialog||!this[`${t}Enable`]||(this.setAction(t),this.dialog=!0)},this.share=async(t,e)=>{t.stopPropagation();const{id:i=""}=e,r=i?`(https://app.riffian.global/${i?"track/"+i:""})`:"",s=await A(`Stay tuned with me. I'm at Riffian.global! #riffian @RiffianClub {${r}}}`);window.open(s,"_blank")},this.listener=k(this.fetch)}get disabled(){return!v.bridge.account}get voteEnable(){return this.inited&&!this.disabled}get retreatEnable(){return this.myVotes?this.inited&&+b(this.myVotes,0)>0:!1}get creatorAddr(){var t,e;return(e=(t=this.subject)==null?void 0:t.creator)==null?void 0:e.address}get empty(){return this.inited&&!this.subject}get loading(){return!this.inited&&this.pending}getRandomInt(t){return Math.floor(Math.random()*t)}connectedCallback(){super.connectedCallback(),this.fetch(),g.on("block-world",this.listener)}disconnectedCallback(){super.disconnectedCallback(),g.off("block-world",this.listener)}render(){return this.loading?a`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-8"><loading-skeleton num="3"></loading-skeleton></div></div>`:a`<div class="grid lg_grid-cols-13 gap-6 lg_gap-8">${h(this.empty,()=>a`<p class="mx-4 h-full">No data found.</p><p></p>`,()=>a`<div class="lg_col-span-6 flex gap-4 md_gap-8"><div class="relative w-32 md_w-44 h-full rounded-xl bg-white/10"><img-loader src="${this.subject.image}" class="w-32 md_w-44 h-full rounded-xl"></img-loader>${h(this.subject.uri,()=>a`<div class="absolute right-1 bottom-1"><ui-button icon lg href="${this.subject.uri}"><i class="mdi mdi-play-circle-outline text-white"></i></ui-button></div>`)}</div><div class="flex flex-col h-full justify-between gap-2 md_gap-4"><div><div class="text-lg md_text-xl mb-1.5 md_mb-2.5">${this.subject.name??"-"}</div><div class="text-sm md_text-base min-h-6 leading-6"><ui-address .address="${this.creatorAddr}" short doid avatar></ui-address></div><div class="text-sm md_text-base md_min-h-6 md_leading-6">${h(this.social,()=>{var t,e,i;return a`${(t=this.social)==null?void 0:t.name}<a class="text-xs leading-none text-blue-300/60" href="${(e=this.social)==null?void 0:e.url}" target="_blank">@${(i=this.social)==null?void 0:i.id}</a>`},()=>a`-`)}</div></div><div class="flex gap-3 md_gap-4 items-center mt-2">${h(this.voteEnable,()=>a`<ui-button class="w-20 md_w-24" ?disabled="${this.dialog||!this.voteEnable}" @click="${()=>this.popAction("vote")}">Vote</ui-button>`)} ${h(this.retreatEnable,()=>a`<ui-button class="w-20 md_w-24" ?disabled="${this.dialog||!this.retreatEnable}" @click="${()=>this.popAction("retreat")}">Retreat</ui-button>`)} ${h(this.dialog,()=>a`<vote-album-dialog action="${this.actionType}" album="${this.subject.id}" url="${this.subject.image}" name="${this.subject.name}" votes="${this.subject.supply}" author="${this.creatorAddr}" @close="${this.close}" @change="${this.fetch}"></vote-album-dialog>`)}<ui-button icon class="!lg_w-10 !lg_h-10 outlined !border-white !rounded-md" @click="${t=>this.share(t,this.subject)}"><slot name="icon"><i class="mdi mdi-share-variant-outline cursor-pointer text-2xl text-white"></i></slot></ui-button></div></div></div><div class="lg_col-start-7 lg_col-span-8 grid grid-cols-8 lg_gap-4 divide-x divide-white/20 md_divide-x-0 place-items-center items-center shrink grow-0"><div class="lg_col-start-1 col-span-2 flex flex-col justify-center items-center w-full lg_h-4/5 lg_bg-white/5 lg_rounded-xl lg_gap-1.5"><div class="text-xs md_text-base text-gray-500 align-center">Voters</div><div class="text-xl lg_text-4xl font-light align-center lining-nums">${this.subject.fansNumber}</div></div><div class="col-span-2 flex flex-col justify-center items-center w-full lg_h-4/5 lg_bg-white/5 lg_rounded-xl lg_gap-1.5"><div class="text-xs md_text-base text-gray-500 align-center">Tickets</div><div class="text-xl lg_text-4xl font-light align-center lining-nums">${this.subject.supply}</div></div><div class="col-span-2 flex flex-col justify-center items-center w-full lg_h-4/5 lg_bg-white/5 lg_rounded-xl lg_gap-1.5"><div class="text-xs md_text-base text-gray-500 align-center">Volume</div><div class="text-xl lg_text-4xl font-light align-center lining-nums">${b(this.subject.totalVoteValue)}</div></div><div class="col-span-2 flex flex-col justify-center items-center w-full lg_h-4/5 lg_bg-white/5 lg_rounded-xl lg_gap-1.5"><div class="text-xs md_text-base text-gray-500 align-center">Price</div><div class="text-xl lg_text-4xl font-light align-center lining-nums">${(+this.subject.supply+1)/10}</div></div></div>`)}</div>${h(this.prompt,()=>a`<p class="text-center text-orange-600">${this.promptMessage}</p>`)}`}};d([m({type:Boolean})],o.prototype,"weekly",2);d([m({type:String})],o.prototype,"trackAddress",2);d([l()],o.prototype,"myVotes",2);d([l()],o.prototype,"social",2);d([l()],o.prototype,"subject",2);d([l()],o.prototype,"voteList",2);d([l()],o.prototype,"pending",2);d([l()],o.prototype,"prompt",2);d([l()],o.prototype,"dialog",2);d([l()],o.prototype,"promptMessage",2);d([l()],o.prototype,"err",2);d([l()],o.prototype,"actionType",2);d([l()],o.prototype,"inited",2);o=d([w("track-detail")],o);const N="";var U=Object.defineProperty,q=Object.getOwnPropertyDescriptor,V=(t,e,i,r)=>{for(var s=r>1?void 0:r?q(e,i):e,n=t.length-1,c;n>=0;n--)(c=t[n])&&(s=(r?c(e,i,s):c(s))||s);return r&&s&&U(e,i,s),s};let x=class extends y(N){constructor(){super(...arguments),this.addr=""}render(){return a`<div class="ui-container mx-auto flex flex-col place-content-center pt-6 lg_pt-12"><track-detail trackAddress="${this.addr}"></track-detail><div class="mt-6 md_mt-14"><div class="w-full inline-flex pb-2 border-b border-slate-50/10"><div class="py-1.5 px-3 text-base font-normal text-white/70 rounded-md">History</div></div><track-votes trackAddress="${this.addr}"></track-votes></div></div>`}};V([m({type:String})],x.prototype,"addr",2);x=V([w("track-page")],x);export{x as TrackPage};
