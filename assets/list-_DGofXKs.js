import{T as x,b as f,w as b,f as y}from"./index-Oxxj_WLT.js";import{a as $}from"./action-fpcS26if.js";import{c as h,y as u,f as w,e as g,$ as _,x as a,n as c,d as S,u as j,k as d,a as m,b as k}from"./vendor-f-QFt302.js";import"./index-E4aM3EDT.js";const C="/assets/empty-SE8Z4v6N.webp?inline",v=(e={})=>({pageNum:1,pageSize:10,hasMore:!0,...e}),L="@media (min-width: 500px){.name{font-size:1rem;line-height:1.5rem}}.icon{font-size:1.25rem;line-height:1.75rem}@media (max-width: 500px){.icon{font-size:1.5rem;line-height:2rem}}";var z=Object.defineProperty,M=Object.getOwnPropertyDescriptor,r=(e,t,i,l)=>{for(var s=l>1?void 0:l?M(t,i):t,o=e.length-1,p;o>=0;o--)(p=e[o])&&(s=(l?p(t,i,s):p(s))||s);return l&&s&&z(t,i,s),s};let n=class extends x(L){constructor(){super(...arguments),this.indScreen=new h(this,u),this.bindBridge=new h(this,f),this.bindWeekly=new h(this,b),this.paging=!1,this.brief=!0,this.pageSize=10,this.subjectList=[],this.pending=!1,this.ts=0,this.err="",this.pagination=v({pageSize:this.pageSize}),this.hasMore=!0,this.fetch=async(e=!1)=>{if(!(this.pending&&!e)&&!(this.paging&&!this.hasMore)){this.err="",this.pending=!0;try{const t={};if(this.pagination){const{pageSize:s,pageNum:o}=this.pagination;Object.assign(t,{first:s,skip:(o-1)*s})}let{subjects:i}=await $(t);const l=i.map(s=>{var o;return{...s,totalVal:+w(s.totalVoteValue).toString(),image:(o=s.image)!=null&&o.startsWith("http")?s.image:C}});this.paging?(this.subjectList.push(...l),this.hasMore=i.length>=this.pagination.pageSize,this.pagination.pageNum++):this.subjectList=[...l]}catch(t){this.err=t.message||t.msg||t}finally{this.pending=!1,this.ts++}}},this.loadmore=()=>{this.fetch()},this.go2=(e,t)=>{var i;e.preventDefault(),e.stopPropagation(),this.disabled?g.emit("connect-wallet"):((i=e.target)==null?void 0:i.tagName)=="I"?window.open(t.uri,"_blank"):_(`/track/${t.id}`)},this.headerEle=()=>this.brief?a`<div class="w-8 md_w-10">Rank</div><div class="flex-shrink">Collection</div><div class="flex-auto"></div><div class="num flex-auto w-32">Volume</div>`:a`<div class="w-16">Index</div><div class="flex-auto">Name</div><div class="flex-none w-40">Created</div><div class="num flex-none w-24">Volume</div><div class="num flex-none w-24">Price</div><div class="num flex-none w-24">24H</div>`,this.itemEle=(e,t)=>this.brief?a`<div class="item flex items-center" @click="${i=>this.go2(i,e)}"><div class="flex-none w-8 md_pl-3 text-sm font-light opacity-70">${t+1}</div><div class="flex-shrink flex justify-center"><img-loader .src="${e.image}" class="w-[3rem] h-[3rem] md_w-[3.75rem] md_h-[3.75rem] rounded-lg cursor-pointer"></img-loader></div><div class="flex-auto flex-col"><div class="inline-flex"><p class="name truncate cursor-pointer ${this.brief?"lg_max-w-64":""}">${e.name}</p><a href="${e.uri}" class="flex-none ml-2" target="_blank"><span class="icon mt-1"><i class="mdi mdi-play-circle opacity-85 hover_opacity-100"></i></span></a></div>${c(this.brief,()=>a`<div class="text-xs text-gray-400/70"><span class="mr-1.5">Price:</span>${(Number(e.supply)+1)/10}</div>`)}</div><div class="num flex-initial flex flex-col !w-12 text-sm items-end"><span>${e.totalVal}</span> <span class="text-xs mt-1.5" style="color:#34c77b">${n.dayChange(e)}</span></div></div>`:a`<div class="item flex items-center hover_cursor-pointer" @click="${i=>this.go2(i,e)}"><div class="flex-none w-16 pl-4 text-sm font-light opacity-75">${t+1} ${c(this.subjectList.length>3&&t<3,()=>a`<i class="mdi mdi-fire text-red-400"></i>`)}</div><div class="flex-auto flex"><div class="w-[3.25rem] h-[3.25rem] mr-4 rounded-lg"><img-loader src="${e.image}" class="rounded-lg"></img-loader></div><div><p class="name truncate">${e.name}</p><span class="icon mt-1"><i class="mdi mdi-play-circle opacity-85 hover_opacity-100"></i></span></div></div><div class="flex-none w-40 text-xs text-gray-300/60">${y(e.createdAt)}</div><div class="flex-none w-24 text-right text-sm"><span>${e.totalVal}</span></div><div class="flex-none w-24 text-right text-sm"><span>${(Number(e.supply)+1)/10}</span></div><div class="flex-none w-24 text-right text-sm"><span>${n.dayChange(e)}</span></div></div>`,this.listen=()=>{this.pagination=v(),this.fetch(!0)}}get disabled(){return!f.bridge.account}get isMobi(){return u.isMobi}get scrollMode(){return"scroll"}get empty(){return this.pending&&!this.subjectList.length}static dayChange(e){if(e.voteLogs.length==0)return"New";{let t=e.voteLogs[0].supply,i=e.supply,l=Math.abs(t-i),s=(l*100/t).toFixed(1);return t>i?a`<p class="text-red-500">-${s}%</p>`:a`<p class="text-green-500">+${s}%</p>`}}async connectedCallback(){super.connectedCallback(),this.fetch(!0),g.on("manual-change",this.listen)}disconnectedCallback(){super.disconnectedCallback(),g.off("manual-change",this.listen)}render(){return a`<div role="list" class="ui-list gap-2 ${S(this.$c([this.pending?"loading":"hover"]))}"><div class="flex header border-bottom">${this.headerEle()}</div>${c(this.empty,()=>a`<div name="loading" class="doc-intro"></div><loading-skeleton num="4"></loading-skeleton>`,()=>a`${j(this.subjectList,(e,t)=>a`${this.itemEle(e,t)}`)} ${c(this.paging,()=>a`<ui-pagination .nomore="${this.err}" mode="${this.scrollMode}" .firstLoad="${!1}" .pending="${this.pending}" @loadmore="${this.loadmore}"></ui-pagination>`)}`)}</div>`}};r([m({type:Boolean})],n.prototype,"paging",2);r([m({type:Boolean})],n.prototype,"brief",2);r([m({type:Number})],n.prototype,"pageSize",2);r([d()],n.prototype,"subjectList",2);r([d()],n.prototype,"pending",2);r([d()],n.prototype,"ts",2);r([d()],n.prototype,"err",2);r([d()],n.prototype,"pagination",2);r([d()],n.prototype,"hasMore",2);n=r([k("top-album")],n);export{C as e,v as p,L as s};
